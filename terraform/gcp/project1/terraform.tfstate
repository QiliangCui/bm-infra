{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 999,
  "lineage": "85f957c8-4558-2ad4-a931-b7524e514e38",
  "outputs": {},
  "resources": [
    {
      "module": "module.a100-1-queue",
      "mode": "managed",
      "type": "google_pubsub_subscription",
      "name": "agent_subscription",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "ack_deadline_seconds": 600,
            "bigquery_config": [],
            "cloud_storage_config": [],
            "dead_letter_policy": [],
            "effective_labels": {},
            "enable_exactly_once_delivery": false,
            "enable_message_ordering": false,
            "expiration_policy": [
              {
                "ttl": "2678400s"
              }
            ],
            "filter": "",
            "id": "projects/cloud-tpu-inference-test/subscriptions/vllm-bm-queue-a100-1-agent",
            "labels": {},
            "message_retention_duration": "604800s",
            "name": "vllm-bm-queue-a100-1-agent",
            "project": "cloud-tpu-inference-test",
            "push_config": [],
            "retain_acked_messages": false,
            "retry_policy": [],
            "terraform_labels": {},
            "timeouts": null,
            "topic": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-a100-1"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.a100-1-queue.google_pubsub_topic.queue"
          ]
        }
      ]
    },
    {
      "module": "module.a100-1-queue",
      "mode": "managed",
      "type": "google_pubsub_topic",
      "name": "queue",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "effective_labels": {},
            "id": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-a100-1",
            "ingestion_data_source_settings": [],
            "kms_key_name": "",
            "labels": {},
            "message_retention_duration": "",
            "message_storage_policy": [
              {
                "allowed_persistence_regions": [
                  "asia-east1",
                  "asia-northeast1",
                  "asia-southeast1",
                  "australia-southeast1",
                  "europe-north1",
                  "europe-north2",
                  "europe-west1",
                  "europe-west2",
                  "europe-west3",
                  "europe-west4",
                  "southamerica-west1",
                  "us-central1",
                  "us-central2",
                  "us-east1",
                  "us-east4",
                  "us-east5",
                  "us-east7",
                  "us-south1",
                  "us-west1",
                  "us-west2",
                  "us-west3",
                  "us-west4",
                  "us-west8"
                ]
              }
            ],
            "name": "vllm-bm-queue-a100-1",
            "project": "cloud-tpu-inference-test",
            "schema_settings": [],
            "terraform_labels": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.h100-8-queue",
      "mode": "managed",
      "type": "google_pubsub_subscription",
      "name": "agent_subscription",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "ack_deadline_seconds": 600,
            "bigquery_config": [],
            "cloud_storage_config": [],
            "dead_letter_policy": [],
            "effective_labels": {},
            "enable_exactly_once_delivery": false,
            "enable_message_ordering": false,
            "expiration_policy": [
              {
                "ttl": "2678400s"
              }
            ],
            "filter": "",
            "id": "projects/cloud-tpu-inference-test/subscriptions/vllm-bm-queue-h100-8-agent",
            "labels": {},
            "message_retention_duration": "604800s",
            "name": "vllm-bm-queue-h100-8-agent",
            "project": "cloud-tpu-inference-test",
            "push_config": [],
            "retain_acked_messages": false,
            "retry_policy": [],
            "terraform_labels": {},
            "timeouts": null,
            "topic": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-h100-8"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.h100-8-queue.google_pubsub_topic.queue"
          ]
        }
      ]
    },
    {
      "module": "module.h100-8-queue",
      "mode": "managed",
      "type": "google_pubsub_topic",
      "name": "queue",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "effective_labels": {},
            "id": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-h100-8",
            "ingestion_data_source_settings": [],
            "kms_key_name": "",
            "labels": {},
            "message_retention_duration": "",
            "message_storage_policy": [
              {
                "allowed_persistence_regions": [
                  "asia-east1",
                  "asia-northeast1",
                  "asia-southeast1",
                  "australia-southeast1",
                  "europe-north1",
                  "europe-north2",
                  "europe-west1",
                  "europe-west2",
                  "europe-west3",
                  "europe-west4",
                  "southamerica-west1",
                  "us-central1",
                  "us-central2",
                  "us-east1",
                  "us-east4",
                  "us-east5",
                  "us-east7",
                  "us-south1",
                  "us-west1",
                  "us-west2",
                  "us-west3",
                  "us-west4",
                  "us-west8"
                ]
              }
            ],
            "name": "vllm-bm-queue-h100-8",
            "project": "cloud-tpu-inference-test",
            "schema_settings": [],
            "terraform_labels": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-1",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "DELETE",
            "effective_labels": {
              "generative-language": "enabled"
            },
            "folder_id": "535970317228",
            "id": "projects/cloud-tpu-inference-test",
            "labels": {
              "generative-language": "enabled"
            },
            "name": "cloud-tpu-inference-test",
            "number": "32478767326",
            "org_id": "",
            "project_id": "cloud-tpu-inference-test",
            "skip_delete": null,
            "terraform_labels": {
              "generative-language": "enabled"
            }
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "module": "module.v6e-1",
      "mode": "managed",
      "type": "google_compute_disk",
      "name": "large_disk",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-23T18:22:30.604-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "7699285298444514361",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-0",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": {},
            "last_attach_timestamp": "2025-07-25T14:33:07.625-07:00",
            "last_detach_timestamp": "2025-07-25T14:20:14.430-07:00",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-1-southamerica-west1-a-0",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 6072,
            "provisioned_throughput": 908,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-0",
            "size": 512,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [
              "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/instances/t1v-n-9c41b787-w-0"
            ],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.614-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "189085044909391780",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-1",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-1-southamerica-west1-a-1",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 6072,
            "provisioned_throughput": 908,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-1",
            "size": 512,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 2,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.598-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "6907348837219286948",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-2",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-1-southamerica-west1-a-2",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 6072,
            "provisioned_throughput": 908,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-2",
            "size": 512,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 3,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.604-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "4057329885304700836",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-3",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-1-southamerica-west1-a-3",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 6072,
            "provisioned_throughput": 908,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-3",
            "size": 512,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-1",
      "mode": "managed",
      "type": "google_tpu_v2_vm",
      "name": "tpu_v6",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "1x1",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-1",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-0"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "HEALTHY",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-1-bm-0",
            "labels": {},
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-1-bm-0\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-1\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-1-bm-0",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.245.66"
                  }
                ],
                "ip_address": "10.194.0.50",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": [],
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-1.data.google_project.current",
            "module.v6e-1.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "1x1",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-1",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-1"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-1-bm-1",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-1-bm-1\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-1\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-1-bm-1",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.119.2"
                  }
                ],
                "ip_address": "10.194.0.84",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-1.data.google_project.current",
            "module.v6e-1.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 2,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "1x1",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-1",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-2"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-1-bm-2",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-1-bm-2\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-1\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-1-bm-2",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.78.19"
                  }
                ],
                "ip_address": "10.194.0.107",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-1.data.google_project.current",
            "module.v6e-1.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 3,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "1x1",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-1",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-1-southamerica-west1-a-3"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-1-bm-3",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-1-bm-3\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-1\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-1-bm-3",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.113.8"
                  }
                ],
                "ip_address": "10.194.0.128",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-1.data.google_project.current",
            "module.v6e-1.google_compute_disk.large_disk"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-1-queue",
      "mode": "managed",
      "type": "google_pubsub_subscription",
      "name": "agent_subscription",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "ack_deadline_seconds": 600,
            "bigquery_config": [],
            "cloud_storage_config": [],
            "dead_letter_policy": [],
            "effective_labels": {},
            "enable_exactly_once_delivery": false,
            "enable_message_ordering": false,
            "expiration_policy": [
              {
                "ttl": "2678400s"
              }
            ],
            "filter": "",
            "id": "projects/cloud-tpu-inference-test/subscriptions/vllm-bm-queue-v6e-1-agent",
            "labels": {},
            "message_retention_duration": "604800s",
            "name": "vllm-bm-queue-v6e-1-agent",
            "project": "cloud-tpu-inference-test",
            "push_config": [],
            "retain_acked_messages": false,
            "retry_policy": [],
            "terraform_labels": {},
            "timeouts": null,
            "topic": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-1"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-1-queue.google_pubsub_topic.queue"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-1-queue",
      "mode": "managed",
      "type": "google_pubsub_topic",
      "name": "queue",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "effective_labels": {},
            "id": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-1",
            "ingestion_data_source_settings": [],
            "kms_key_name": "",
            "labels": {},
            "message_retention_duration": "",
            "message_storage_policy": [
              {
                "allowed_persistence_regions": [
                  "asia-east1",
                  "asia-northeast1",
                  "asia-southeast1",
                  "australia-southeast1",
                  "europe-north1",
                  "europe-north2",
                  "europe-west1",
                  "europe-west2",
                  "europe-west3",
                  "europe-west4",
                  "southamerica-west1",
                  "us-central1",
                  "us-central2",
                  "us-east1",
                  "us-east4",
                  "us-east5",
                  "us-east7",
                  "us-south1",
                  "us-west1",
                  "us-west2",
                  "us-west3",
                  "us-west4",
                  "us-west8"
                ]
              }
            ],
            "name": "vllm-bm-queue-v6e-1",
            "project": "cloud-tpu-inference-test",
            "schema_settings": [],
            "terraform_labels": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-4",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "DELETE",
            "effective_labels": {
              "generative-language": "enabled"
            },
            "folder_id": "535970317228",
            "id": "projects/cloud-tpu-inference-test",
            "labels": {
              "generative-language": "enabled"
            },
            "name": "cloud-tpu-inference-test",
            "number": "32478767326",
            "org_id": "",
            "project_id": "cloud-tpu-inference-test",
            "skip_delete": null,
            "terraform_labels": {
              "generative-language": "enabled"
            }
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "module": "module.v6e-4-queue",
      "mode": "managed",
      "type": "google_pubsub_subscription",
      "name": "agent_subscription",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "ack_deadline_seconds": 600,
            "bigquery_config": [],
            "cloud_storage_config": [],
            "dead_letter_policy": [],
            "effective_labels": {},
            "enable_exactly_once_delivery": false,
            "enable_message_ordering": false,
            "expiration_policy": [
              {
                "ttl": "2678400s"
              }
            ],
            "filter": "",
            "id": "projects/cloud-tpu-inference-test/subscriptions/vllm-bm-queue-v6e-4-agent",
            "labels": {},
            "message_retention_duration": "604800s",
            "name": "vllm-bm-queue-v6e-4-agent",
            "project": "cloud-tpu-inference-test",
            "push_config": [],
            "retain_acked_messages": false,
            "retry_policy": [],
            "terraform_labels": {},
            "timeouts": null,
            "topic": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-4"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-4-queue.google_pubsub_topic.queue"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-4-queue",
      "mode": "managed",
      "type": "google_pubsub_topic",
      "name": "queue",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "effective_labels": {},
            "id": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-4",
            "ingestion_data_source_settings": [],
            "kms_key_name": "",
            "labels": {},
            "message_retention_duration": "",
            "message_storage_policy": [
              {
                "allowed_persistence_regions": [
                  "asia-east1",
                  "asia-northeast1",
                  "asia-southeast1",
                  "australia-southeast1",
                  "europe-north1",
                  "europe-north2",
                  "europe-west1",
                  "europe-west2",
                  "europe-west3",
                  "europe-west4",
                  "southamerica-west1",
                  "us-central1",
                  "us-central2",
                  "us-east1",
                  "us-east4",
                  "us-east5",
                  "us-east7",
                  "us-south1",
                  "us-west1",
                  "us-west2",
                  "us-west3",
                  "us-west4",
                  "us-west8"
                ]
              }
            ],
            "name": "vllm-bm-queue-v6e-4",
            "project": "cloud-tpu-inference-test",
            "schema_settings": [],
            "terraform_labels": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-8",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "DELETE",
            "effective_labels": {
              "generative-language": "enabled"
            },
            "folder_id": "535970317228",
            "id": "projects/cloud-tpu-inference-test",
            "labels": {
              "generative-language": "enabled"
            },
            "name": "cloud-tpu-inference-test",
            "number": "32478767326",
            "org_id": "",
            "project_id": "cloud-tpu-inference-test",
            "skip_delete": null,
            "terraform_labels": {
              "generative-language": "enabled"
            }
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "module": "module.v6e-8",
      "mode": "managed",
      "type": "google_compute_disk",
      "name": "large_disk",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-23T19:08:59.703-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "8767794185830673236",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-0",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": {},
            "last_attach_timestamp": "2025-07-25T14:33:07.236-07:00",
            "last_detach_timestamp": "2025-07-25T14:20:07.983-07:00",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-8-southamerica-west1-a-0",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 15288,
            "provisioned_throughput": 2400,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-0",
            "size": 2048,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [
              "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/instances/t1v-n-785464cb-w-0"
            ],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.594-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "7478686685676027812",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-1",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-8-southamerica-west1-a-1",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 15288,
            "provisioned_throughput": 2400,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-1",
            "size": 2048,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 2,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.615-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "4126025662411161508",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-2",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-8-southamerica-west1-a-2",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 15288,
            "provisioned_throughput": 2400,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-2",
            "size": 2048,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        },
        {
          "index_key": 3,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "async_primary_disk": [],
            "creation_timestamp": "2025-07-25T15:12:27.667-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "5919999563118788516",
            "effective_labels": {},
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-3",
            "image": "",
            "interface": null,
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-8-southamerica-west1-a-3",
            "physical_block_size_bytes": 4096,
            "project": "cloud-tpu-inference-test",
            "provisioned_iops": 15288,
            "provisioned_throughput": 2400,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-3",
            "size": 2048,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "storage_pool": "",
            "terraform_labels": {},
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-8",
      "mode": "managed",
      "type": "google_tpu_v2_vm",
      "name": "tpu_v6",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "2x4",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-8",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-0"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "HEALTHY",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-8-bm-0",
            "labels": {},
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-8-bm-0\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-8\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-8-bm-0",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.64.190"
                  }
                ],
                "ip_address": "10.194.0.37",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": [],
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-8.data.google_project.current",
            "module.v6e-8.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "2x4",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-8",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-1"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-8-bm-1",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-8-bm-1\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-8\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-8-bm-1",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.27.216"
                  }
                ],
                "ip_address": "10.194.0.53",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-8.data.google_project.current",
            "module.v6e-8.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 2,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "2x4",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-8",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-2"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "HEALTHY",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-8-bm-2",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-8-bm-2\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-8\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-8-bm-2",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.106.102"
                  }
                ],
                "ip_address": "10.194.0.87",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-8.data.google_project.current",
            "module.v6e-8.google_compute_disk.large_disk"
          ]
        },
        {
          "index_key": 3,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "2x4",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-8",
            "api_version": "V2",
            "cidr_block": "10.194.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-tpu-inference-test/zones/southamerica-west1-a/disks/tpu-bm-disk-v6e-8-southamerica-west1-a-3"
              }
            ],
            "description": "",
            "effective_labels": {},
            "health": "",
            "health_description": "",
            "id": "projects/cloud-tpu-inference-test/locations/southamerica-west1-a/nodes/vllm-tpu-v6e-8-bm-3",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-8-bm-3\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-8\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-8-bm-3",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-tpu-inference-test/global/networks/default",
                "subnetwork": "projects/cloud-tpu-inference-test/regions/southamerica-west1/subnetworks/default"
              }
            ],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "34.176.154.4"
                  }
                ],
                "ip_address": "10.194.0.120",
                "port": 8470
              }
            ],
            "project": "cloud-tpu-inference-test",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true
              }
            ],
            "service_account": [
              {
                "email": "32478767326-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {},
            "timeouts": null,
            "zone": "southamerica-west1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-8.data.google_project.current",
            "module.v6e-8.google_compute_disk.large_disk"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-8-queue",
      "mode": "managed",
      "type": "google_pubsub_subscription",
      "name": "agent_subscription",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "ack_deadline_seconds": 600,
            "bigquery_config": [],
            "cloud_storage_config": [],
            "dead_letter_policy": [],
            "effective_labels": {},
            "enable_exactly_once_delivery": false,
            "enable_message_ordering": false,
            "expiration_policy": [
              {
                "ttl": "2678400s"
              }
            ],
            "filter": "",
            "id": "projects/cloud-tpu-inference-test/subscriptions/vllm-bm-queue-v6e-8-agent",
            "labels": {},
            "message_retention_duration": "604800s",
            "name": "vllm-bm-queue-v6e-8-agent",
            "project": "cloud-tpu-inference-test",
            "push_config": [],
            "retain_acked_messages": false,
            "retry_policy": [],
            "terraform_labels": {},
            "timeouts": null,
            "topic": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-8"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-8-queue.google_pubsub_topic.queue"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-8-queue",
      "mode": "managed",
      "type": "google_pubsub_topic",
      "name": "queue",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "effective_labels": {},
            "id": "projects/cloud-tpu-inference-test/topics/vllm-bm-queue-v6e-8",
            "ingestion_data_source_settings": [],
            "kms_key_name": "",
            "labels": {},
            "message_retention_duration": "",
            "message_storage_policy": [
              {
                "allowed_persistence_regions": [
                  "asia-east1",
                  "asia-northeast1",
                  "asia-southeast1",
                  "australia-southeast1",
                  "europe-north1",
                  "europe-north2",
                  "europe-west1",
                  "europe-west2",
                  "europe-west3",
                  "europe-west4",
                  "southamerica-west1",
                  "us-central1",
                  "us-central2",
                  "us-east1",
                  "us-east4",
                  "us-east5",
                  "us-east7",
                  "us-south1",
                  "us-west1",
                  "us-west2",
                  "us-west3",
                  "us-west4",
                  "us-west8"
                ]
              }
            ],
            "name": "vllm-bm-queue-v6e-8",
            "project": "cloud-tpu-inference-test",
            "schema_settings": [],
            "terraform_labels": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    }
  ],
  "check_results": null
}

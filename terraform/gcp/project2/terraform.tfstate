{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 26,
  "lineage": "fefb879e-0d54-8049-9357-3f314f24ebda",
  "outputs": {},
  "resources": [
    {
      "module": "module.v6e-1",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "PREVENT",
            "effective_labels": {},
            "folder_id": "535970317228",
            "id": "projects/cloud-ullm-inference-ci-cd",
            "labels": {},
            "name": "Cloud-uLLM-Inference-CI-CD",
            "number": "443452445451",
            "org_id": "",
            "project_id": "cloud-ullm-inference-ci-cd",
            "tags": null,
            "terraform_labels": {}
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "module": "module.v6e-4",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "PREVENT",
            "effective_labels": {},
            "folder_id": "535970317228",
            "id": "projects/cloud-ullm-inference-ci-cd",
            "labels": {},
            "name": "Cloud-uLLM-Inference-CI-CD",
            "number": "443452445451",
            "org_id": "",
            "project_id": "cloud-ullm-inference-ci-cd",
            "tags": null,
            "terraform_labels": {}
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "module": "module.v6e-4",
      "mode": "managed",
      "type": "google_compute_disk",
      "name": "large_disk",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "access_mode": "READ_WRITE_SINGLE",
            "architecture": null,
            "async_primary_disk": [],
            "create_snapshot_before_destroy": false,
            "create_snapshot_before_destroy_prefix": null,
            "creation_timestamp": "2025-07-17T21:46:10.494-07:00",
            "description": "",
            "disk_encryption_key": [],
            "disk_id": "817357559673679741",
            "effective_labels": {
              "goog-terraform-provisioned": "true"
            },
            "enable_confidential_compute": false,
            "guest_os_features": [],
            "id": "projects/cloud-ullm-inference-ci-cd/zones/asia-east1-c/disks/tpu-bm-disk-v6e-4-asia-east1-c-100",
            "image": "",
            "interface": null,
            "label_fingerprint": "vezUS-42LLM=",
            "labels": {},
            "last_attach_timestamp": "",
            "last_detach_timestamp": "",
            "licenses": [],
            "multi_writer": false,
            "name": "tpu-bm-disk-v6e-4-asia-east1-c-100",
            "params": [],
            "physical_block_size_bytes": 4096,
            "project": "cloud-ullm-inference-ci-cd",
            "provisioned_iops": 6072,
            "provisioned_throughput": 908,
            "resource_policies": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/cloud-ullm-inference-ci-cd/zones/asia-east1-c/disks/tpu-bm-disk-v6e-4-asia-east1-c-100",
            "size": 512,
            "snapshot": "",
            "source_disk": "",
            "source_disk_id": "",
            "source_image_encryption_key": [],
            "source_image_id": "",
            "source_instant_snapshot": "",
            "source_instant_snapshot_id": "",
            "source_snapshot_encryption_key": [],
            "source_snapshot_id": "",
            "source_storage_object": null,
            "storage_pool": "",
            "terraform_labels": {
              "goog-terraform-provisioned": "true"
            },
            "timeouts": null,
            "type": "hyperdisk-balanced",
            "users": [],
            "zone": "asia-east1-c"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.v6e-4",
      "mode": "managed",
      "type": "google_tpu_v2_vm",
      "name": "tpu_v6",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "accelerator_config": [
              {
                "topology": "2x2",
                "type": "V6E"
              }
            ],
            "accelerator_type": "v6e-4",
            "api_version": "V2_ALPHA1",
            "cidr_block": "10.140.0.0/20",
            "data_disks": [
              {
                "mode": "READ_WRITE",
                "source_disk": "projects/cloud-ullm-inference-ci-cd/zones/asia-east1-c/disks/tpu-bm-disk-v6e-4-asia-east1-c-100"
              }
            ],
            "description": "",
            "effective_labels": {
              "goog-terraform-provisioned": "true"
            },
            "health": "HEALTHY",
            "health_description": "",
            "id": "projects/cloud-ullm-inference-ci-cd/locations/asia-east1-c/nodes/vllm-tpu-v6e-4-bm-100",
            "labels": null,
            "metadata": {
              "startup-script": "#!/bin/bash     \n\n# Set env vars system-wide\ngrep -q \"^GCP_PROJECT_ID=\" /etc/environment || echo \"GCP_PROJECT_ID=cloud-tpu-inference-test\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_ID=\" /etc/environment || echo \"GCP_INSTANCE_ID=vllm-bm-inst\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_DATABASE_ID=\" /etc/environment || echo \"GCP_DATABASE_ID=vllm-bm-runs\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_REGION=\" /etc/environment || echo \"GCP_REGION=southamerica-west1\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_INSTANCE_NAME=\" /etc/environment || echo \"GCP_INSTANCE_NAME=vllm-tpu-v6e-4-bm-100\" | sudo tee -a /etc/environment\ngrep -q \"^GCS_BUCKET=\" /etc/environment || echo \"GCS_BUCKET=vllm-cb-storage2\" | sudo tee -a /etc/environment\ngrep -q \"^GCP_QUEUE=\" /etc/environment || echo \"GCP_QUEUE=vllm-bm-queue-v6e-4\" | sudo tee -a /etc/environment\nif ! grep -q \"^HF_TOKEN=\" /etc/environment; then\n  gcloud secrets versions access latest --secret=bm-agent-hf-token --quiet | \\\n  sudo tee -a /etc/environment \u003e /dev/null \u003c\u003c\u003c \"HF_TOKEN=$(cat)\"\nfi\n\napt-get update\napt-get install -y curl build-essential jq\n\ncurl -o- https://get.docker.com/ | bash -\n\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n/root/.cargo/bin/cargo install minijinja-cli\ncp /root/.cargo/bin/minijinja-cli /usr/bin/minijinja-cli\nchmod 777 /usr/bin/minijinja-cli\n\n# Mount persistent disk\n\nsudo mkdir -p /mnt/disks/persist\n\n# Format if not already formatted\nif ! blkid /dev/nvme0n2; then\n  echo \"Formatting /dev/nvme0n2 as ext4...\"\n  sudo mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/nvme0n2\nfi\n\n# Add to /etc/fstab using UUID\ndisk_uuid=$(blkid -s UUID -o value /dev/nvme0n2)\nif ! grep -q \"/mnt/disks/persist\" /etc/fstab; then\n  echo \"UUID=$disk_uuid /mnt/disks/persist ext4 defaults,discard 0 2\" | sudo tee -a /etc/fstab\nfi\n\n# Only mount if not already mounted (first boot or recovery)\nif ! mountpoint -q /mnt/disks/persist; then\n  sudo mount /mnt/disks/persist  \nfi\n\njq \". + {\\\"data-root\\\": \\\"/mnt/disks/persist\\\"}\" /etc/docker/daemon.json \u003e /tmp/daemon.json.tmp \u0026\u0026 mv /tmp/daemon.json.tmp /etc/docker/daemon.json\nsystemctl stop docker\nsystemctl daemon-reload\nsystemctl start docker\n\nuseradd -m -s /bin/bash bm-agent\nsudo usermod -aG docker bm-agent\n\n# Run the commands below as bm-agent user:\nsudo -u bm-agent -i bash \u003c\u003c EOBM\ngcloud auth configure-docker southamerica-west1-docker.pkg.dev --quiet\nrm -rf bm-infra\ngit clone https://github.com/QiliangCui/bm-infra.git\npushd bm-infra\ngit pull\ngit reset --hard 33d7a95ccac00f3e76d60c39e62d50d538f8fe40\npopd\nEOBM\ncp /home/bm-agent/bm-infra/service/bm-agent/bm-agent.service /etc/systemd/system/bm-agent.service\nsystemctl stop bm-agent.service\nsystemctl daemon-reload\nsystemctl enable bm-agent.service\nsystemctl start bm-agent.service\n"
            },
            "multislice_node": false,
            "name": "vllm-tpu-v6e-4-bm-100",
            "network_config": [
              {
                "can_ip_forward": false,
                "enable_external_ips": true,
                "network": "projects/cloud-ullm-inference-ci-cd/global/networks/default",
                "queue_count": 0,
                "subnetwork": "projects/cloud-ullm-inference-ci-cd/regions/asia-east1/subnetworks/default"
              }
            ],
            "network_configs": [],
            "network_endpoints": [
              {
                "access_config": [
                  {
                    "external_ip": "35.236.173.20"
                  }
                ],
                "ip_address": "10.140.0.3",
                "port": 8470
              }
            ],
            "project": "cloud-ullm-inference-ci-cd",
            "queued_resource": "",
            "runtime_version": "v2-alpha-tpuv6e",
            "scheduling_config": [
              {
                "preemptible": false,
                "reserved": true,
                "spot": false
              }
            ],
            "service_account": [
              {
                "email": "443452445451-compute@developer.gserviceaccount.com",
                "scope": [
                  "https://www.googleapis.com/auth/devstorage.read_write",
                  "https://www.googleapis.com/auth/logging.write",
                  "https://www.googleapis.com/auth/service.management",
                  "https://www.googleapis.com/auth/servicecontrol",
                  "https://www.googleapis.com/auth/cloud-platform",
                  "https://www.googleapis.com/auth/pubsub"
                ]
              }
            ],
            "shielded_instance_config": [],
            "state": "READY",
            "symptoms": [],
            "tags": null,
            "terraform_labels": {
              "goog-terraform-provisioned": "true"
            },
            "timeouts": null,
            "zone": "asia-east1-c"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.v6e-4.data.google_project.current",
            "module.v6e-4.google_compute_disk.large_disk"
          ]
        }
      ]
    },
    {
      "module": "module.v6e-8",
      "mode": "data",
      "type": "google_project",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/google\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_network": null,
            "billing_account": "004CBF-132918-897366",
            "deletion_policy": "PREVENT",
            "effective_labels": {},
            "folder_id": "535970317228",
            "id": "projects/cloud-ullm-inference-ci-cd",
            "labels": {},
            "name": "Cloud-uLLM-Inference-CI-CD",
            "number": "443452445451",
            "org_id": "",
            "project_id": "cloud-ullm-inference-ci-cd",
            "tags": null,
            "terraform_labels": {}
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    }
  ],
  "check_results": null
}

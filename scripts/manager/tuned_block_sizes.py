# Key:
#   - hidden_size: int, padded hidden dimension size
#   - intermediate_size: int, padded intermediate dimension size
#   - num_experts: int, total number of experts
#   - top_k: int, selected number of top experts
#   - t_packing: int, token packing
#   - w_packing: int, weight packing
#   - num_tokens: int, total number of tokens
#   - ep_size: int, expert parallelism size
# Value:
#   - bt: int, block size of local_num_tokens
#   - bf: int, block size of intermediate_size
#   - bd1: int, block size of hidden_size in w1
#   - bd2: int, block size of hidden_size in w2
#   - btc: int, compute size of block tokens for active expert
#   - bfc: int, compute size of block intermediate_size
#   - bd1c: int, compute size of block hidden_size in w1
#   - bd2c: int, compute size of block hidden_size in w2
TUNED_BLOCK_SIZES = {
    (3072, 3072, 128, 4, 2, 2, 128, 4): (
        32,
        256 * 6,
        256 * 12,
        256 * 12,
        16,
        256 * 6,
        256 * 12,
        256 * 12,
    ),
    (3072, 3072, 128, 4, 2, 2, 256, 4): (
        64,
        256 * 6,
        256 * 6,
        256 * 12,
        16,
        256 * 6,
        256 * 6,
        256 * 12,
    ),
    (3072, 3072, 128, 4, 2, 2, 512, 4): (
        128,
        256 * 6,
        256 * 6,
        256 * 6,
        64,
        256 * 6,
        256 * 6,
        256 * 6,
    ),
    (3072, 3072, 128, 4, 2, 2, 1024, 4): (
        128,
        256 * 3,
        256 * 6,
        256 * 6,
        64,
        256 * 3,
        256 * 6,
        256 * 6,
    ),
    (3072, 3072, 128, 4, 2, 2, 2048, 4): (
        128,
        256 * 3,
        256 * 6,
        256 * 6,
        64,
        256 * 3,
        256 * 6,
        256 * 6,
    ),
    (3072, 3072, 128, 4, 2, 2, 128, 8): (
        16,
        1536,
        1536,
        1536 * 2,
        16,
        1536,
        1536,
        1536,
    ),
    (3072, 3072, 128, 4, 2, 2, 256, 8): (
        32,
        1536,
        1536,
        1536 * 2,
        32,
        1536,
        1536,
        1536,
    ),
    (3072, 3072, 128, 4, 2, 2, 512, 8): (
        64,
        1536,
        1536,
        1536 * 2,
        64,
        1536,
        1536,
        1536,
    ),
    (3072, 3072, 128, 4, 2, 2, 1024, 8): (
        64,
        1536,
        1536,
        1536 * 2,
        64,
        1536,
        1536,
        1536,
    ),
    (3072, 3072, 128, 4, 2, 2, 2048, 8): (
        64,
        1536,
        1536,
        1536 * 2,
        64,
        1536,
        1536,
        1536,
    ),
    # for qwen3-coder-480b, we use a temporary huristic block size here. Need to tune for better performance.
    (6144, 2560, 160, 8, 2, 4, 16, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 32, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 64, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 128, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 256, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 512, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 1024, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 2048, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 4096, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
    (6144, 2560, 160, 8, 2, 4, 8192, 8): (
        64,
        1280,
        1536,
        1536,
        64,
        1280,
        1536,
        1536,
    ),
}
